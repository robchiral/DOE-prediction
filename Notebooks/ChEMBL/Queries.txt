cd chembl_35_sqlite
sqlite3 chembl_35.db
.headers ON
.mode csv
.output chembl_35_molecule_synonyms.csv
SELECT 
    molregno, 
    syn_type, 
    molsyn_id, 
    res_stem_id, 
    synonyms 
FROM 
    molecule_synonyms;
.output stdout
.exit


cd chembl_35_sqlite
sqlite3 chembl_35.db
.headers ON
.mode csv
.output chembl_35_phase.csv
SELECT
    md.chembl_id,
    md.max_phase AS max_clinical_trial_phase,
    CASE
        WHEN md.max_phase = 4 THEN 'Approved'
        WHEN md.max_phase < 4 AND md.max_phase >= 0 THEN 'In Clinical Trials'
        WHEN md.max_phase = -1 THEN 'Unknown Phase'
        ELSE 'Preclinical'
    END AS approval_status
FROM
    molecule_dictionary md
ORDER BY
    md.max_phase DESC;
.output stdout
.exit


cd chembl_35_sqlite
sqlite3 chembl_35.db
.headers ON
.mode csv
.output chembl_35_drug_targets.csv
WITH genes AS (
    SELECT 
        td.tid, 
        td.target_type, 
        td.organism, 
        tc.component_id, 
        cs.compsyn_id, 
        cs.component_synonym, 
        cs.syn_type 
    FROM TARGET_DICTIONARY td
    INNER JOIN TARGET_COMPONENTS tc ON tc.tid = td.tid
    INNER JOIN COMPONENT_SYNONYMS cs ON tc.component_id = cs.component_id
),
Drugs AS (
    SELECT 
        m.molregno, 
        m.pref_name, 
        m.chembl_id, 
        m.molecule_type, 
        d.tid, 
        d.action_type, 
        d.molecular_mechanism, 
        d.disease_efficacy
    FROM MOLECULE_DICTIONARY m
    INNER JOIN DRUG_MECHANISM d ON m.molregno = d.molregno
)
SELECT DISTINCT 
    d.molregno, 
    d.pref_name, 
    d.chembl_id, 
    d.molecule_type, 
    d.tid, 
    d.action_type, 
    d.molecular_mechanism, 
    d.disease_efficacy, 
    g.target_type, 
    g.organism, 
    g.component_id, 
    g.compsyn_id, 
    g.component_synonym, 
    g.syn_type 
FROM Drugs d
INNER JOIN genes g ON g.tid = d.tid;
.output stdout
.exit